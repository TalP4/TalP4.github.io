<!DOCTYPE html>
<html>
<head>
    <title>Project TalP4</title>
    <link rel="stylesheet" type="text/css" href="styles.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <div class="container">
        <div class="auth-box" id="auth-box">
            <h2>Welcome back!</h2>
            <label for="username-input">USERNAME</label>
            <input type="text" id="username-input" placeholder="Enter your username..." autocomplete="off">
            <button onclick="setUsername()">Continue</button>
        </div>
        <div class="chat-area" id="chat-container" style="display:none;">
            <div style="margin-bottom:18px; color:#b9bbbe; font-size:20px; font-weight:bold"># general</div>
            <div id="chat" style="flex:1 1 auto; overflow-y:auto; max-height:380px;"></div>
            <div style="display:flex;align-items:center;margin-top:12px;">
                <input type="text" id="message" placeholder="Type your message..." autocomplete="off" style="flex:1;">
                <button onclick="sendMessage()" style="width:120px; margin-left:12px;">Send</button>
            </div>
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
        var socket = new WebSocket("wss://talp4.github.io/"); // Use wss:// for WebSocket Secure
        var username = "";

        function setUsername() {
            var usernameInput = document.getElementById("username-input");
            username = usernameInput.value;
            if (username.trim() === "") {
                alert("Please enter a username.");
                return;
            }
            document.getElementById("auth-box").style.display = "none";
            document.getElementById("chat-container").style.display = "flex";
        }

        socket.onmessage = function(event) {
            var chat = document.getElementById("chat");
            var messageWrapper = document.createElement("div");
            messageWrapper.className = "message" + (event.data.startsWith(username + ":") ? " me" : "");
            // Add a fake avatar for Discord look
            var avatar = document.createElement("div");
            avatar.style = "width:40px;height:40px;background:#5865f2;border-radius:50%;display:inline-block;margin-right:12px;vertical-align:middle;";
            avatar.innerHTML = '<svg width="40" height="40" viewBox="0 0 40 40"><circle cx="20" cy="20" r="20" fill="#5865f2"/><text x="20" y="28" text-anchor="middle" fill="#fff" font-size="20">' + event.data.charAt(0).toUpperCase() + '</text></svg>';
            var content = document.createElement("span");
            content.textContent = event.data;
            messageWrapper.appendChild(avatar);
            messageWrapper.appendChild(content);
            chat.appendChild(messageWrapper);
            chat.scrollTop = chat.scrollHeight;
        };

        function sendMessage() {
            var messageInput = document.getElementById("message");
            var message = messageInput.value;
            if (message.trim() === "") return;
            messageInput.value = "";
            socket.send(username + ": " + message);
        }

        // Allow enter to send
        document.getElementById("message").addEventListener("keydown", function(e) {
            if (e.key === "Enter") sendMessage();
        });
        document.getElementById("username-input").addEventListener("keydown", function(e) {
            if (e.key === "Enter") setUsername();
        });
    </script>
</body>
</html>